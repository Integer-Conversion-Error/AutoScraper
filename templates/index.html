<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>AutoScraper Web Interface</title>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
			rel="stylesheet"
		/>
		<link
			rel="stylesheet"
			href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
		/>
		<style>
			.loading {
				display: none;
			}
			.form-section {
				margin-bottom: 20px;
				border-bottom: 1px solid #eee;
				/* border-bottom: 1px solid #eee; */ /* Removed for Accordion */
				padding-bottom: 20px;
			}
			/* .form-section:last-child { */ /* Removed for Accordion */
			/* border-bottom: none; */
			/* } */
			#notification {
				position: fixed;
				top: 20px;
				right: 20px;
				z-index: 1050;
				max-width: 400px;
			}
			.keyword-badge {
				margin-right: 5px;
				margin-bottom: 5px;
			}
			#loadingCard {
				display: none;
			}
			.sortable {
				cursor: pointer;
				position: relative;
			}
			.sortable:hover {
				background-color: rgba(0, 0, 0, 0.05);
			}
			.sort-icon {
				margin-left: 5px;
			}
			/* Ensure AI modal appears above results modal */
			#aiAnalysisModal {
				z-index: 1060; /* Higher than default modal z-index (1050/1055) */
			}
			/* Improve AI content formatting */
			#aiAnalysisContent h1,
			#aiAnalysisContent h2,
			#aiAnalysisContent h3,
			#aiAnalysisContent h4,
			#aiAnalysisContent h5,
			#aiAnalysisContent h6 {
				margin-top: 1rem;
				margin-bottom: 0.5rem;
				font-weight: 500;
			}
			#aiAnalysisContent ul,
			#aiAnalysisContent ol {
				padding-left: 2rem;
				margin-bottom: 1rem;
			}
			#aiAnalysisContent p {
				margin-bottom: 1rem;
			}

			/* --- Dynamic Styling Enhancements --- */

			/* General Transitions */
			.btn, .accordion-button, .nav-link, .dropdown-item, .card {
				transition: all 0.3s ease-in-out;
			}

			/* Button Hover Effects */
			.btn:hover {
				transform: translateY(-2px); /* Subtle lift effect */
				box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
			}
			.btn-primary:hover, .btn-success:hover, .btn-info:hover, .btn-warning:hover, .btn-danger:hover {
				filter: brightness(110%); /* Slightly brighten colored buttons */
			}
			.btn-secondary:hover, .btn-outline-secondary:hover, .btn-outline-light:hover {
				filter: brightness(95%); /* Slightly darken secondary/outline buttons */
			}


			/* Card Hover/Shadow */
			.card {
				box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
			}
			.card:hover {
				box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
				transform: translateY(-3px);
			}

			/* Accordion Button Hover */
			.accordion-button:not(.collapsed):hover {
				background-color: #e9ecef; /* Lighter background on hover when open */
			}
			.accordion-button.collapsed:hover {
				background-color: #f8f9fa; /* Slightly different background on hover when closed */
			}

			/* Navbar Link Hover */
			.navbar-nav .nav-link:hover,
			.navbar-brand:hover {
				color: #adb5bd !important; /* Lighter color on hover */
			}
			.dropdown-item:hover {
				background-color: #e9ecef;
			}

			/* Modal Enhancements */
			.modal-content {
				border-radius: 0.5rem; /* Slightly more rounded corners */
				box-shadow: 0 5px 15px rgba(0,0,0,0.2);
			}
			.modal-header {
				border-bottom: 1px solid #dee2e6;
			}
			.modal-footer {
				border-top: 1px solid #dee2e6;
			}

			/* Subtle animation for loading spinner */
			@keyframes spin {
				0% { transform: rotate(0deg); }
				100% { transform: rotate(360deg); }
			}
			.spinner-border {
				animation: spin 1s linear infinite;
			}

			/* Input Focus */
			.form-control:focus, .form-select:focus {
				border-color: #86b7fe; /* Bootstrap's default focus color */
				box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25); /* Bootstrap's default focus shadow */
			}

			/* Accordion Icon Rotation */
			.accordion-button::after {
				transition: transform 0.3s ease-in-out; /* Smooth transition for the icon */
			}
			.accordion-button:not(.collapsed)::after {
				transform: rotate(-180deg); /* Rotate icon when open */
			}

			/* Table Row Hover in Modal */
			#resultsTableContainer table tbody tr:hover {
				background-color: rgba(0, 0, 0, 0.075); /* Subtle hover effect for table rows */
				cursor: pointer; /* Indicate rows are interactive (if they are) */
			}

			/* --- End Dynamic Styling Enhancements --- */

		</style>
	</head>
	<body>
		<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
			<!-- Changed navbar color to primary blue -->
			<div class="container">
				<a class="navbar-brand" href="#">
					<i class="bi bi-car-front"></i> AutoScraper Web
				</a>
				<button
					class="navbar-toggler"
					type="button"
					data-bs-toggle="collapse"
					data-bs-target="#navbarNavDropdown"
					aria-controls="navbarNavDropdown"
					aria-expanded="false"
					aria-label="Toggle navigation"
				>
					<span class="navbar-toggler-icon"></span>
				</button>
				<div class="collapse navbar-collapse" id="navbarNavDropdown">
					<ul class="navbar-nav ms-auto">
						<li class="nav-item dropdown">
							<a
								class="nav-link dropdown-toggle text-white"
								href="#"
								id="userDropdown"
								role="button"
								data-bs-toggle="dropdown"
								aria-expanded="false"
							>
								<i class="bi bi-person-circle"></i> {{ username
								}}
							</a>
							<ul
								class="dropdown-menu dropdown-menu-end"
								aria-labelledby="userDropdown"
							>
								<li>
									<a
										class="dropdown-item"
										href="#"
										id="settingsBtn"
										><i class="bi bi-gear"></i> Settings</a
									>
								</li>
								<li><hr class="dropdown-divider" /></li>
								<li>
									<a
										class="dropdown-item"
										href="{{ url_for('auth.logout') }}" <!-- Use blueprint name -->
										id="logoutLink"
										><i class="bi bi-box-arrow-right"></i>
										Logout</a
									>
								</li>
							</ul>
						</li>
						<!-- Add token display -->
						<li class="nav-item d-flex align-items-center ms-2">
							<span
								class="navbar-text text-white"
								id="tokenCountDisplay"
							>
								<i class="bi bi-coin"></i> Tokens:
								<span id="tokenValue">...</span>
							</span>
						</li>
					</ul>
				</div>
			</div>
		</nav>

		<div class="container mt-4 mb-5">
			{% with messages = get_flashed_messages(with_categories=true) %} {%
			if messages %} {% for category, message in messages %}
			<div
				class="alert alert-{{ category }} alert-dismissible fade show"
				role="alert"
			>
				{{ message }}
				<button
					type="button"
					class="btn-close"
					data-bs-dismiss="alert"
					aria-label="Close"
				></button>
			</div>
			{% endfor %} {% endif %} {% endwith %}

			<div
				id="notification"
				class="toast align-items-center text-white bg-primary border-0"
				role="alert"
				aria-live="assertive"
				aria-atomic="true"
			>
				<div class="d-flex">
					<div class="toast-body" id="notification-content">
						Notification message
					</div>
					<button
						type="button"
						class="btn-close btn-close-white me-2 m-auto"
						data-bs-dismiss="toast"
						aria-label="Close"
					></button>
				</div>
			</div>

			<div class="card mb-4">
				<div class="card-header bg-primary text-white">
					<!-- Changed header color to primary blue -->
					<h5 class="mb-0">
						<i class="bi bi-search"></i> Search Parameters
					</h5>
				</div>
				<div class="card-body">
					<form id="searchForm">
						<!-- Start Accordion -->
						<div class="accordion" id="searchAccordion">
							<!-- Item 1: Vehicle Selection -->
							<div class="accordion-item">
								<h2
									class="accordion-header"
									id="headingVehicle"
								>
									<button
										class="accordion-button"
										type="button"
										data-bs-toggle="collapse"
										data-bs-target="#collapseVehicle"
										aria-expanded="true"
										aria-controls="collapseVehicle"
									>
										<i class="bi bi-car-front me-2"></i>
										Vehicle Selection
									</button>
								</h2>
								<div
									id="collapseVehicle"
									class="accordion-collapse collapse show"
									aria-labelledby="headingVehicle"
									data-bs-parent="#searchAccordion"
								>
									<div class="accordion-body">
										<div class="row mb-3">
											<div class="col-md-4">
												<!-- Adjusted to col-md-4 -->
												<label
													for="makeSelect"
													class="form-label"
													>Make</label
												>
												<div class="input-group">
													<select
														class="form-select"
														id="makeSelect"
														required
													>
														<option value="">
															Select Make
														</option>
													</select>
													<button
														class="btn btn-outline-secondary"
														type="button"
														id="showAllMakes"
													>
														Show All
													</button>
												</div>
											</div>
											<div class="col-md-4">
												<!-- Adjusted to col-md-4 -->
												<label
													for="modelSelect"
													class="form-label"
													>Model</label
												>
												<select
													class="form-select"
													id="modelSelect"
												>
													<option value="">
														Select Model (Choose
														Make First)
													</option>
												</select>
											</div>
											<div class="col-md-3">
												<!-- Adjusted to col-md-3 -->
												<label
													for="trimSelect"
													class="form-label"
													>Trim</label
												>
												<select
													class="form-select"
													id="trimSelect"
												>
													<option value="">
														Any Trim (Select Model
														First)
													</option>
												</select>
											</div>
											<div class="col-md-3">
												<!-- Added Color Dropdown -->
												<label
													for="colorSelect"
													class="form-label"
													>Color</label
												>
												<select
													class="form-select"
													id="colorSelect"
												>
													<option value="">
														Any Color (Select
														Trim/Model First)
													</option>
												</select>
											</div>
										</div>
										<!-- Moved Content from Additional Filters -->
										<hr> <!-- Add a separator -->
										<h6>Vehicle Condition & Specs</h6>
										<div class="row mb-3">
											<div class="col-md-3"> <!-- Adjusted grid -->
												<div class="form-check mb-2">
													<input
														class="form-check-input"
														type="checkbox"
														value=""
														id="isNew"
														checked
													/>
													<label
														class="form-check-label"
														for="isNew"
													>
														New
													</label>
												</div>
											</div>
											<div class="col-md-3"> <!-- Adjusted grid -->
												<div class="form-check mb-2">
													<input
														class="form-check-input"
														type="checkbox"
														value=""
														id="isUsed"
														checked
													/>
													<label
														class="form-check-label"
														for="isUsed"
													>
														Used
													</label>
												</div>
											</div>
											<div class="col-md-3"> <!-- Adjusted grid -->
												<div class="form-check mb-2">
													<input
														class="form-check-input"
														type="checkbox"
														value=""
														id="withPhotos"
														checked
													/>
													<label
														class="form-check-label"
														for="withPhotos"
													>
														Photos
													</label>
												</div>
											</div>
											<div class="col-md-3"> <!-- Adjusted grid -->
												<div class="form-check mb-2">
													<input
														class="form-check-input"
														type="checkbox"
														value=""
														id="isDamaged"
													/>
													<label
														class="form-check-label"
														for="isDamaged"
													>
														Damaged
													</label>
												</div>
											</div>
										</div>

										<!-- Filters (Drivetrain, Transmission) -->
										<div class="row mb-3">
											<div class="col-md-6">
												<label
													for="drivetrainSelect"
													class="form-label"
													>Drivetrain</label
												>
												<select
													class="form-select"
													id="drivetrainSelect"
												>
													<option value="">Any</option>
													<option value="AWD">AWD</option>
													<option value="FWD">FWD</option>
													<option value="RWD">RWD</option>
													<option value="4WD">4WD</option>
												</select>
											</div>
											<div class="col-md-6">
												<label
													for="transmissionSelect"
													class="form-label"
													>Transmission</label
												>
												<select
													class="form-select"
													id="transmissionSelect"
												>
													<option value="">Any</option>
													<option value="Automatic">Automatic</option>
													<option value="Manual">Manual</option>
													
												</select>
											</div>
										</div>
										<!-- End New Filters -->

										<!-- Vehicle Spec Filters -->
										<div class="row mb-3">
											<div class="col-md-4">
												<label
													for="bodyTypeInput"
													class="form-label"
													>Body Type</label
												>
												<input
													type="text"
													class="form-control"
													id="bodyTypeInput"
													placeholder="e.g., Sedan, SUV"
												/>
											</div>
											<div class="col-md-4">
												<label
													for="numDoorsInput"
													class="form-label"
													>Doors</label
												>
												<input
													type="number"
													class="form-control"
													id="numDoorsInput"
													placeholder="e.g., 4"
												/>
											</div>
											<div class="col-md-4">
												<label
													for="seatingCapacityInput"
													class="form-label"
													>Seats</label
												>
												<input
													type="number"
													class="form-control"
													id="seatingCapacityInput"
													placeholder="e.g., 5"
												/>
											</div>
										</div>
										<!-- End Vehicle Spec Filters -->
									</div>
									<!-- End Accordion Body -->
								</div>
								<!-- End Accordion Collapse -->
							</div>
							<!-- End Accordion Item -->

							<!-- Item 2: Location -->
							<div class="accordion-item">
								<h2
									class="accordion-header"
									id="headingLocation"
								>
									<button
										class="accordion-button collapsed"
										type="button"
										data-bs-toggle="collapse"
										data-bs-target="#collapseLocation"
										aria-expanded="false"
										aria-controls="collapseLocation"
									>
										<i class="bi bi-geo-alt me-2"></i>
										Location
									</button>
								</h2>
								<div
									id="collapseLocation"
									class="accordion-collapse collapse"
									aria-labelledby="headingLocation"
									data-bs-parent="#searchAccordion"
								>
									<div class="accordion-body">
										<div class="row mb-3">
											<div class="col-md-6">
												<label
													for="address"
													class="form-label"
													>Address</label
												>
												<input
													type="text"
													class="form-control"
													id="address"
													value="Kanata, ON"
												/>
											</div>
											<div class="col-md-6">
												<label
													for="proximity"
													class="form-label"
													>Distance (km, -1 for
													unlimited)</label
												>
												<input
													type="number"
													class="form-control"
													id="proximity"
													value="-1"
												/>
											</div>
										</div>
									</div>
									<!-- End Accordion Body -->
								</div>
								<!-- End Accordion Collapse -->
							</div>
							<!-- End Accordion Item -->

							<!-- Item 3: Year Range -->
							<div class="accordion-item">
								<h2 class="accordion-header" id="headingYear">
									<button
										class="accordion-button collapsed"
										type="button"
										data-bs-toggle="collapse"
										data-bs-target="#collapseYear"
										aria-expanded="false"
										aria-controls="collapseYear"
									>
										<i class="bi bi-calendar me-2"></i> Year
										Range
									</button>
								</h2>
								<div
									id="collapseYear"
									class="accordion-collapse collapse"
									aria-labelledby="headingYear"
									data-bs-parent="#searchAccordion"
								>
									<div class="accordion-body">
										<div class="row mb-3">
											<div class="col-md-6">
												<label
													for="yearMin"
													class="form-label"
													>Minimum Year</label
												>
												<input
													type="number"
													class="form-control"
													id="yearMin"
													placeholder="e.g. 2015"
												/>
											</div>
											<div class="col-md-6">
												<label
													for="yearMax"
													class="form-label"
													>Maximum Year</label
												>
												<input
													type="number"
													class="form-control"
													id="yearMax"
													placeholder="e.g. 2023"
												/>
											</div>
										</div>
									</div>
									<!-- End Accordion Body -->
								</div>
								<!-- End Accordion Collapse -->
							</div>
							<!-- End Accordion Item -->

							<!-- Item 4: Price Range -->
							<div class="accordion-item">
								<h2 class="accordion-header" id="headingPrice">
									<button
										class="accordion-button collapsed"
										type="button"
										data-bs-toggle="collapse"
										data-bs-target="#collapsePrice"
										aria-expanded="false"
										aria-controls="collapsePrice"
									>
										<i
											class="bi bi-currency-dollar me-2"
										></i>
										Price Range
									</button>
								</h2>
								<div
									id="collapsePrice"
									class="accordion-collapse collapse"
									aria-labelledby="headingPrice"
									data-bs-parent="#searchAccordion"
								>
									<div class="accordion-body">
										<div class="row mb-3">
											<div class="col-md-6">
												<label
													for="priceMin"
													class="form-label"
													>Minimum Price ($)</label
												>
												<input
													type="number"
													class="form-control"
													id="priceMin"
													placeholder="e.g. 5000"
												/>
											</div>
											<div class="col-md-6">
												<label
													for="priceMax"
													class="form-label"
													>Maximum Price ($)</label
												>
												<input
													type="number"
													class="form-control"
													id="priceMax"
													placeholder="e.g. 25000"
												/>
											</div>
										</div>
									</div>
									<!-- End Accordion Body -->
								</div>
								<!-- End Accordion Collapse -->
							</div>
							<!-- End Accordion Item -->

							<!-- Item 5: Mileage -->
							<div class="accordion-item">
								<h2
									class="accordion-header"
									id="headingMileage"
								>
									<button
										class="accordion-button collapsed"
										type="button"
										data-bs-toggle="collapse"
										data-bs-target="#collapseMileage"
										aria-expanded="false"
										aria-controls="collapseMileage"
									>
										<i class="bi bi-speedometer2 me-2"></i>
										Mileage
									</button>
								</h2>
								<div
									id="collapseMileage"
									class="accordion-collapse collapse"
									aria-labelledby="headingMileage"
									data-bs-parent="#searchAccordion"
								>
									<div class="accordion-body">
										<div class="row mb-3">
											<div class="col-md-6">
												<label
													for="odometerMin"
													class="form-label"
													>Minimum KMs</label
												>
												<input
													type="number"
													class="form-control"
													id="odometerMin"
													placeholder="e.g. 0"
												/>
											</div>
											<div class="col-md-6">
												<label
													for="odometerMax"
													class="form-label"
													>Maximum KMs</label
												>
												<input
													type="number"
													class="form-control"
													id="odometerMax"
													placeholder="e.g. 100000"
												/>
											</div>
										</div>
									</div>
									<!-- End Accordion Body -->
								</div>
								<!-- End Accordion Collapse -->
							</div>
							<!-- End Accordion Item -->

							<!-- Item 6: Keyword Filtering -->
							<div class="accordion-item">
								<h2
									class="accordion-header"
									id="headingKeywords"
								>
									<button
										class="accordion-button collapsed"
										type="button"
										data-bs-toggle="collapse"
										data-bs-target="#collapseKeywords"
										aria-expanded="false"
										aria-controls="collapseKeywords"
									>
										<i class="bi bi-tags me-2"></i> Keyword
										Filtering
									</button>
								</h2>
								<div
									id="collapseKeywords"
									class="accordion-collapse collapse"
									aria-labelledby="headingKeywords"
									data-bs-parent="#searchAccordion"
								>
									<div class="accordion-body">
										<div class="mb-3">
											<label
												for="exclusionKeyword"
												class="form-label"
												>Exclusion Keywords</label
											>
											<div class="input-group mb-2">
												<input
													type="text"
													class="form-control"
													id="exclusionKeyword"
													placeholder="e.g. salvage, rebuilt, damaged"
												/>
												<button
													class="btn btn-outline-secondary"
													type="button"
													id="addExclusionBtn"
												>
													Add
												</button>
											</div>
											<div
												id="exclusionsList"
												class="mt-2"
											></div>
										</div>
										<div class="mb-3">
											<label
												for="inclusion"
												class="form-label"
												>Required Inclusion
												String</label
											>
											<input
												type="text"
												class="form-control"
												id="inclusion"
												placeholder="e.g. leather, navigation"
											/>
										</div>
									</div>
									<!-- End Accordion Body -->
								</div>
								<!-- End Accordion Collapse -->
							</div>
							<!-- End Accordion Item -->
						</div>
						<!-- End Accordion -->

						<!-- Action Buttons - Moved outside accordion -->
						<div
							class="d-grid gap-2 d-md-flex justify-content-md-end mt-3"
						>
							<button
								class="btn btn-secondary me-md-2"
								type="button"
								id="createPayloadBtn"
							>
								<i class="bi bi-plus-circle"></i> Create Payload
							</button>
							<button
								class="btn btn-primary btn-lg"
								type="button"
								id="fetchDataBtn"
							>
								<!-- Changed Fetch button to primary blue -->
								<i class="bi bi-search"></i> Fetch Data
							</button>
						</div>
					</form>
				</div>
			</div>

			<!-- Rearranged Layout: Payload & Saved Results Side-by-Side -->
			<div class="row">
				<!-- Payload Management -->
				<div class="col-md-6">
					<div class="card mb-4">
						<div class="card-header bg-primary text-white">
							<!-- Changed header color to primary blue -->
							<h5 class="mb-0">
								<i class="bi bi-save"></i> Payload Management
							</h5>
						</div>
						<div class="card-body">
							<div class="mb-3">
								<label for="payloadSelect" class="form-label"
								>Load Saved Payload</label
								>
								<select class="form-select" id="payloadSelect">
									<option value="">
										Select a saved payload
									</option>
								</select>
							</div>
							<div
								class="d-grid gap-2 d-md-flex justify-content-md-between"
							>
								<button
									class="btn btn-primary"
									type="button"
									id="loadPayloadBtn"
								>
									<!-- Changed Load button to primary blue -->
									<i class="bi bi-download"></i> Load Selected
								</button>
								<button
									class="btn btn-warning"
									type="button"
									id="renamePayloadBtn"
								>
									<!-- Keep Rename as Warning -->
									<i class="bi bi-pencil"></i> Rename
								</button>
								<button
									class="btn btn-danger"
									type="button"
									id="deletePayloadBtn"
								>
									<!-- Keep Delete as Danger -->
									<i class="bi bi-trash"></i> Delete
								</button>
								<button
									class="btn btn-secondary"
									type="button"
									id="savePayloadBtn"
								>
									<i class="bi bi-upload"></i> Save Current
								</button>
							</div>
						</div>
					</div>
				</div>

				<!-- Saved Results Management -->
				<div class="col-md-6">
					<div class="card mb-4">
						<div class="card-header bg-primary text-white">
							<!-- Changed header color to primary blue -->
							<h5 class="mb-0">
								<i class="bi bi-table"></i> Saved Results
								Management
							</h5>
							<button
								class="btn btn-sm btn-outline-light float-end"
								id="refreshResultsBtn"
							>
								<!-- Changed refresh button style -->
								<i class="bi bi-arrow-clockwise"></i> Refresh
							</button>
						</div>
						<div class="card-body">
							<div class="mb-3">
								<label for="resultSelect" class="form-label"
								>View Saved Results</label
								>
								<select class="form-select" id="resultSelect">
									<option value="">
										Select a saved result
									</option>
								</select>
							</div>
							<div
								class="d-grid gap-2 d-md-flex justify-content-md-between"
							>
								<div>
									<button
										class="btn btn-primary"
										type="button"
										id="viewResultBtn"
									>
										<!-- Changed View button to primary blue -->
										<i class="bi bi-eye"></i> View Selected
									</button>
									<button
										class="btn btn-warning"
										type="button"
										id="renameResultBtn"
									>
										<!-- Keep Rename as Warning -->
										<i class="bi bi-pencil"></i> Rename
									</button>
								</div>
								<button
									class="btn btn-danger"
									type="button"
									id="deleteResultBtn"
								>
									<i class="bi bi-trash"></i> Delete Selected
								</button>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- End Row for Payload & Saved Results -->

			<!-- Current Search Results Card (Below, Full Width) -->
			<div class="row">
				<div class="col-md-12">
					<div class="card mb-4">
						<div class="card-header bg-primary text-white">
							<!-- Changed header color to primary blue -->
							<h5 class="mb-0">
								<i class="bi bi-list-check"></i> Current Search
								Results
							</h5>
						</div>
						<div class="card-body">
							<div id="resultsInfo">
								<p>No search performed yet.</p>
							</div>
							<div class="d-grid gap-2 mt-3">
								<!-- Added margin top -->
								<div class="row">
									<div class="col-md-6 mb-2 mb-md-0">
										<button
											class="btn btn-primary w-100"
											type="button"
											id="openLinksBtn"
											disabled
										>
											<!-- Changed button color to primary blue -->
											<i
												class="bi bi-box-arrow-up-right"
											></i>
											Open Links in Browser
										</button>
									</div>
									<div class="col-md-6">
										<button
											class="btn btn-primary w-100"
											type="button"
											id="downloadCsvBtn"
											disabled
										>
											<!-- Changed button color to primary blue -->
											<i class="bi bi-download"></i>
											Download CSV
										</button>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- End Row for Current Search Results -->

			<!-- Modal for displaying AI Analysis -->
			<div
				class="modal fade"
				id="aiAnalysisModal"
				tabindex="-1"
				aria-labelledby="aiAnalysisModalLabel"
				aria-hidden="true"
			>
				<div class="modal-dialog modal-lg">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="aiAnalysisModalLabel">
								AI Reliability Analysis
							</h5>
							<button
								type="button"
								class="btn-close"
								data-bs-dismiss="modal"
								aria-label="Close"
							></button>
						</div>
						<div class="modal-body">
							<div
								id="aiAnalysisLoading"
								style="display: none"
								class="text-center"
							>
								<div
									class="spinner-border text-primary"
									role="status"
								>
									<span class="visually-hidden"
										>Loading...</span
									>
								</div>
								<p>Analyzing reliability information...</p>
							</div>
							<div
								id="aiAnalysisContent"
								style="white-space: pre-wrap"
							>
								<!-- AI summary will be loaded here -->
							</div>
							<div
								id="aiAnalysisError"
								class="alert alert-danger"
								style="display: none"
							>
								<!-- Error message will be shown here -->
							</div>
						</div>
						<div class="modal-footer">
							<button
								type="button"
								class="btn btn-secondary"
								data-bs-dismiss="modal"
							>
								Close
							</button>
						</div>
					</div>
				</div>
			</div>

			<!-- Modal for displaying results -->
			<div
				class="modal fade"
				id="resultsModal"
				tabindex="-1"
				aria-labelledby="resultsModalLabel"
				aria-hidden="true"
			>
				<div class="modal-dialog modal-xl">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="resultsModalLabel">
								Vehicle Results
							</h5>
							<button
								type="button"
								class="btn-close"
								data-bs-dismiss="modal"
								aria-label="Close"
							></button>
						</div>

						<!-- Action buttons below header -->
						<div class="px-3 py-2 bg-light border-bottom">
							<div class="d-flex justify-content-end gap-2">
								<button
									type="button"
									class="btn btn-primary"
									id="openSelectedLinksBtn"
								>
									<!-- Changed button color to primary blue -->
									<i class="bi bi-box-arrow-up-right"></i>
									Open Selected Links
								</button>
								<button
									type="button"
									class="btn btn-primary"
									id="downloadSelectedResultBtn"
								>
									<!-- Already primary blue -->
									<i class="bi bi-download"></i> Download CSV
								</button>
							</div>
						</div>

						<div class="modal-body">
							<!-- Filter Row -->
							<div class="row mb-3 gx-2 gy-2">
								<!-- Added gy-2 for vertical spacing on smaller screens -->
								<div class="col-md-2">
									<label
										for="filterMake"
										class="form-label form-label-sm"
										>Make</label
									>
									<select
										id="filterMake"
										class="form-select form-select-sm"
									>
										<option value="">All Makes</option>
										<!-- Options added dynamically -->
									</select>
								</div>
								<div class="col-md-2">
									<label
										for="filterModel"
										class="form-label form-label-sm"
										>Model</label
									>
									<select
										id="filterModel"
										class="form-select form-select-sm"
									>
										<option value="">All Models</option>
										<!-- Options added dynamically -->
									</select>
								</div>
								<div class="col-md-2">
									<label
										for="filterTrim"
										class="form-label form-label-sm"
										>Trim</label
									>
									<input
										type="text"
										id="filterTrim"
										class="form-control form-control-sm"
										placeholder="Contains..."
									/>
								</div>
								<div class="col-md-1">
									<label
										for="filterYear"
										class="form-label form-label-sm"
										>Year</label
									>
									<input
										type="number"
										id="filterYear"
										class="form-control form-control-sm"
										placeholder="Year"
									/>
								</div>
								<div class="col-md-2">
									<label
										for="filterPriceMax"
										class="form-label form-label-sm"
										>Max Price</label
									>
									<input
										type="number"
										id="filterPriceMax"
										class="form-control form-control-sm"
										placeholder="Max $"
									/>
								</div>
								<div class="col-md-1">
									<label
										for="filterKmsMax"
										class="form-label form-label-sm"
										>Max KMs</label
									>
									<input
										type="number"
										id="filterKmsMax"
										class="form-control form-control-sm"
										placeholder="Max KMs"
									/>
								</div>
								<div class="col-md-1">
									<label
										for="filterDrivetrain"
										class="form-label form-label-sm"
										>Drive</label
									>
									<select
										id="filterDrivetrain"
										class="form-select form-select-sm"
									>
										<option value="">All</option>
										<!-- Options added dynamically -->
									</select>
								</div>
								<div class="col-md-1 d-flex align-items-end">
									<button
										id="applyFiltersBtn"
										class="btn btn-sm btn-secondary w-100"
										title="Apply Filters"
									>
										<i class="bi bi-funnel-fill"></i>
									</button>
								</div>
							</div>
							<!-- End Filter Row -->

							<div
								id="resultsTableContainer"
								class="table-responsive"
							>
								<!-- Table will be inserted here dynamically -->
							</div>
						</div>

						<div class="modal-footer">
							<button
								type="button"
								class="btn btn-secondary"
								data-bs-dismiss="modal"
							>
								Close
							</button>
						</div>
					</div>
				</div>
			</div>
			<!-- Rename Modal -->
			<div
				class="modal fade"
				id="renameModal"
				tabindex="-1"
				aria-labelledby="renameModalLabel"
				aria-hidden="true"
			>
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="renameModalLabel">
								Rename Item
							</h5>
							<button
								type="button"
								class="btn-close"
								data-bs-dismiss="modal"
								aria-label="Close"
							></button>
						</div>
						<div class="modal-body">
							<input type="hidden" id="renameItemType" value="" />
							<input type="hidden" id="renameItemId" value="" />
							<div class="mb-3">
								<label for="newItemName" class="form-label"
									>New Name</label
								>
								<input
									type="text"
									class="form-control"
									id="newItemName"
									placeholder="Enter a descriptive name"
								/>
							</div>
						</div>
						<div class="modal-footer">
							<button
								type="button"
								class="btn btn-secondary"
								data-bs-dismiss="modal"
							>
								Cancel
							</button>
							<button
								type="button"
								class="btn btn-primary"
								id="saveRenameBtn"
							>
								Save
							</button>
						</div>
					</div>
				</div>
			</div>

			<!-- User Settings Modal -->
			<div
				class="modal fade"
				id="userSettingsModal"
				tabindex="-1"
				aria-labelledby="userSettingsModalLabel"
				aria-hidden="true"
			>
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="userSettingsModalLabel">
								User Settings
							</h5>
							<button
								type="button"
								class="btn-close"
								data-bs-dismiss="modal"
								aria-label="Close"
							></button>
						</div>
						<div class="modal-body">
							<div
								id="userSettingsLoading"
								class="text-center"
								style="display: none"
							>
								<div
									class="spinner-border text-primary"
									role="status"
								>
									<span class="visually-hidden"
										>Loading...</span
									>
								</div>
							</div>
							<div id="userSettingsForm">
								<div class="mb-3">
									<label
										for="userTokensInput"
										class="form-label"
										>Search Tokens</label
									>
									<div class="input-group">
										<button
											class="btn btn-outline-secondary"
											type="button"
											id="decreaseTokensBtn"
										>
											-
										</button>
										<input
											type="number"
											class="form-control text-center"
											id="userTokensInput"
											min="0"
											value="0"
										/>
										<button
											class="btn btn-outline-secondary"
											type="button"
											id="increaseTokensBtn"
										>
											+
										</button>
									</div>
									<div class="form-text">
										1 token = 100 listings scanned during
										search.
									</div>
								</div>
								<div class="form-check mb-3">
									<input
										class="form-check-input"
										type="checkbox"
										value=""
										id="canUseAiCheckbox"
									/>
									<label
										class="form-check-label"
										for="canUseAiCheckbox"
									>
										Allow AI Analysis
									</label>
								</div>
								<div
									id="userSettingsError"
									class="alert alert-danger"
									style="display: none"
								></div>
							</div>
						</div>
						<div class="modal-footer">
							<button
								type="button"
								class="btn btn-secondary"
								data-bs-dismiss="modal"
							>
								Cancel
							</button>
							<button
								type="button"
								class="btn btn-primary"
								id="saveUserSettingsBtn"
							>
								Save Settings
							</button>
						</div>
					</div>
				</div>
			</div>
			<!-- End User Settings Modal -->

			<!-- Name Payload Modal -->
			<div
				class="modal fade"
				id="namePayloadModal"
				tabindex="-1"
				aria-labelledby="namePayloadModalLabel"
				aria-hidden="true"
			>
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="namePayloadModalLabel">
								Name Your Payload
							</h5>
							<button
								type="button"
								class="btn-close"
								data-bs-dismiss="modal"
								aria-label="Close"
							></button>
						</div>
						<div class="modal-body">
							<div class="mb-3">
								<label for="payloadName" class="form-label"
									>Enter a descriptive name for this
									search</label
								>
								<input
									type="text"
									class="form-control"
									id="payloadName"
									placeholder="e.g., Toyota Camry 2018-2020"
								/>
								<div class="form-text">
									A descriptive name will help you identify
									this search later.
								</div>
							</div>
						</div>
						<div class="modal-footer">
							<button
								type="button"
								class="btn btn-secondary"
								data-bs-dismiss="modal"
							>
								Cancel
							</button>
							<button
								type="button"
								class="btn btn-primary"
								id="saveNamedPayloadBtn"
							>
								Save
							</button>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- Close main container -->

		<!-- Bootstrap JS -->
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>
		<!-- Added Showdown library -->

		<!-- Firebase -->
		<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
		<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
		<script src="static/index.js"></script>
	</body>
</html>
